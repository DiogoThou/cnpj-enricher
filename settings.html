<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNPJ Enricher - Configura√ß√µes</title>
    <style>
        body {
            font-family: 'Lexend', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #33475b;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        h1 {
            color: #33475b;
            text-align: center;
            margin-bottom: 8px;
            font-size: 2.2em;
            font-weight: 700;
        }
        
        .subtitle {
            text-align: center;
            color: #7c98b6;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .mapping-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 32px;
        }
        
        .mapping-section h3 {
            margin-top: 0;
            font-size: 1.4em;
            margin-bottom: 16px;
        }
        
        .field-mapping {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .cnpj-field {
            background: rgba(255,255,255,0.15);
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        .hubspot-field select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #33475b;
            font-size: 14px;
            font-weight: 500;
        }
        
        .hubspot-field select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
        }
        
        .actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 32px;
        }
        
        button {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(66, 153, 225, 0.4);
        }
        
        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }
        
        .status {
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-weight: 600;
            text-align: center;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #2f855a;
            border: 2px solid #68d391;
        }
        
        .status.error {
            background: #fed7d7;
            color: #c53030;
            border: 2px solid #fc8181;
        }
        
        .info-box {
            background: #e8f4fd;
            border: 2px solid #90cdf4;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .info-box h4 {
            margin-top: 0;
            color: #2b6cb0;
        }
        
        @media (max-width: 768px) {
            .field-mapping {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .actions {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öôÔ∏è Configura√ß√µes CNPJ Enricher</h1>
        <p class="subtitle">Configure como os dados do CNPJ ser√£o mapeados nos campos do HubSpot</p>
        
        <div class="info-box">
            <h4>üìã Como funciona:</h4>
            <p>Escolha qual campo do HubSpot receber√° cada dado obtido da consulta do CNPJ. 
            Deixe em "N√£o mapear" para campos que n√£o deseja preencher.</p>
        </div>
        
        <div class="mapping-section">
            <h3>üéØ Mapeamento de Campos</h3>
            
            <div class="field-mapping">
                <div class="cnpj-field">üè¢ Raz√£o Social</div>
                <div class="hubspot-field">
                    <select id="razao_social">
                        <option value="">-- N√£o mapear --</option>
                        <option value="name">Nome da empresa</option>
                        <option value="description">Descri√ß√£o</option>
                        <option value="about_us">Sobre n√≥s</option>
                        <option value="razao_social">Raz√£o Social (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">‚ú® Nome Fantasia</div>
                <div class="hubspot-field">
                    <select id="nome_fantasia">
                        <option value="">-- N√£o mapear --</option>
                        <option value="name">Nome da empresa</option>
                        <option value="description">Descri√ß√£o</option>
                        <option value="nome_fantasia">Nome Fantasia (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üìä Situa√ß√£o Cadastral</div>
                <div class="hubspot-field">
                    <select id="situacao_cadastral">
                        <option value="">-- N√£o mapear --</option>
                        <option value="description">Descri√ß√£o</option>
                        <option value="notes_last_contacted">Notas</option>
                        <option value="situacao_cadastral">Situa√ß√£o Cadastral (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üí∞ Capital Social</div>
                <div class="hubspot-field">
                    <select id="capital_social">
                        <option value="">-- N√£o mapear --</option>
                        <option value="annualrevenue">Receita anual</option>
                        <option value="description">Descri√ß√£o</option>
                        <option value="capital_social">Capital Social (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üè≠ Porte da Empresa</div>
                <div class="hubspot-field">
                    <select id="porte">
                        <option value="">-- N√£o mapear --</option>
                        <option value="numberofemployees">N√∫mero de funcion√°rios</option>
                        <option value="company_size">Tamanho da empresa</option>
                        <option value="porte">Porte (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üíº Atividade Principal</div>
                <div class="hubspot-field">
                    <select id="atividade_principal">
                        <option value="">-- N√£o mapear --</option>
                        <option value="industry">Setor</option>
                        <option value="description">Descri√ß√£o</option>
                        <option value="atividade_principal">Atividade Principal (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üìû Telefone</div>
                <div class="hubspot-field">
                    <select id="telefone">
                        <option value="">-- N√£o mapear --</option>
                        <option value="phone">Telefone</option>
                        <option value="mobilephone">Telefone celular</option>
                        <option value="telefone">Telefone (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üìß Email</div>
                <div class="hubspot-field">
                    <select id="email">
                        <option value="">-- N√£o mapear --</option>
                        <option value="domain">Dom√≠nio</option>
                        <option value="description">Descri√ß√£o</option>
                        <option value="cnpj_email">Email CNPJ (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üè† Endere√ßo Completo</div>
                <div class="hubspot-field">
                    <select id="endereco">
                        <option value="">-- N√£o mapear --</option>
                        <option value="address">Endere√ßo</option>
                        <option value="address2">Endere√ßo 2</option>
                        <option value="endereco_completo">Endere√ßo Completo (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üèôÔ∏è Cidade</div>
                <div class="hubspot-field">
                    <select id="cidade">
                        <option value="">-- N√£o mapear --</option>
                        <option value="city">Cidade</option>
                        <option value="cidade">Cidade (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üó∫Ô∏è Estado</div>
                <div class="hubspot-field">
                    <select id="estado">
                        <option value="">-- N√£o mapear --</option>
                        <option value="state">Estado</option>
                        <option value="estado">Estado (customizado)</option>
                    </select>
                </div>
            </div>
            
            <div class="field-mapping">
                <div class="cnpj-field">üìÆ CEP</div>
                <div class="hubspot-field">
                    <select id="cep">
                        <option value="">-- N√£o mapear --</option>
                        <option value="zip">CEP</option>
                        <option value="cep">CEP (customizado)</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="actions">
            <button type="button" class="btn-secondary" onclick="loadDefaults()">
                üîÑ Carregar Padr√µes
            </button>
            <button type="button" class="btn-primary" onclick="saveMapping()">
                üíæ Salvar Configura√ß√µes
            </button>
        </div>
        
        <div id="status"></div>
    </div>

    <script>
        // Configura√ß√µes padr√£o
        const defaultMapping = {
            razao_social: 'name',
            nome_fantasia: 'description',
            situacao_cadastral: 'situacao_cadastral',
            capital_social: 'capital_social',
            porte: 'porte',
            atividade_principal: 'industry',
            telefone: 'phone',
            email: 'cnpj_email',
            endereco: 'address',
            cidade: 'city',
            estado: 'state',
            cep: 'zip'
        };

        // Carregar configura√ß√µes padr√£o
        function loadDefaults() {
            Object.keys(defaultMapping).forEach(field => {
                const select = document.getElementById(field);
                if (select) {
                    select.value = defaultMapping[field];
                }
            });
            showStatus('Configura√ß√µes padr√£o carregadas!', 'success');
        }

        // Salvar mapeamento
        async function saveMapping() {
            const mapping = {};
            
            Object.keys(defaultMapping).forEach(field => {
                const select = document.getElementById(field);
                if (select && select.value) {
                    mapping[field] = select.value;
                }
            });

            try {
                showStatus('Salvando configura√ß√µes...', 'info');
                
                const response = await fetch('/api/save-mapping', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ mapping })
                });

                const result = await response.json();

                if (response.ok) {
                    showStatus('‚úÖ Configura√ß√µes salvas com sucesso!', 'success');
                    
                    // Notificar o HubSpot que as configura√ß√µes foram salvas
                    if (window.parent && window.parent.postMessage) {
                        window.parent.postMessage({
                            type: 'CONFIGURATION_SAVED',
                            data: mapping
                        }, '*');
                    }
                } else {
                    showStatus(`‚ùå Erro: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus('‚ùå Erro ao salvar configura√ß√µes', 'error');
                console.error('Erro:', error);
            }
        }

        // Mostrar status
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 3000);
            }
        }

        // Carregar configura√ß√µes salvas ao iniciar
        async function loadSavedMapping() {
            try {
                const response = await fetch('/api/get-mapping');
                if (response.ok) {
                    const result = await response.json();
                    const mapping = result.mapping || defaultMapping;
                    
                    Object.keys(mapping).forEach(field => {
                        const select = document.getElementById(field);
                        if (select) {
                            select.value = mapping[field] || '';
                        }
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
                loadDefaults();
            }
        }

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedMapping();
        });
    </script>
</body>
</html>